<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Dashboard Air Quality - Video Monitoring</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    :root {
      --primary: #1a1a2e;
      --secondary: #16213e;
      --accent: #0f3460;
      --highlight: #e94560;
      --text: #ffffff;
      --card-bg: rgba(30, 30, 46, 0.7);
    }
    
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
      color: var(--text);
      min-height: 100vh;
      padding: 20px;
    }
    
    .container {
      max-width: 1400px;
      margin: 0 auto;
    }
    
    header {
      text-align: center;
      padding: 20px;
      margin-bottom: 20px;
      background: var(--card-bg);
      border-radius: 15px;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
    }
    
    h1 {
      font-size: 2.5rem;
      margin-bottom: 10px;
      background: linear-gradient(to right, #4cc9f0, #e94560);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }
    
    .subtitle {
      font-size: 1.2rem;
      opacity: 0.8;
    }
    
    .dashboard {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
      margin-bottom: 20px;
    }
    
    @media (max-width: 1024px) {
      .dashboard {
        grid-template-columns: 1fr;
      }
    }
    
    .video-section {
      background: var(--card-bg);
      border-radius: 15px;
      padding: 20px;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
    }
    
    .video-title {
      font-size: 1.5rem;
      margin-bottom: 15px;
      text-align: center;
      color: #4cc9f0;
    }
    
    .video-container {
      position: relative;
      border-radius: 10px;
      overflow: hidden;
      margin-bottom: 15px;
    }
    
    .video-container img {
      width: 100%;
      display: block;
      transition: transform 0.3s ease;
    }
    
    .video-container:hover img {
      transform: scale(1.02);
    }
    
    .video-status {
      position: absolute;
      top: 10px;
      right: 10px;
      bottom: 20px;
      background: rgba(0, 0, 0, 0.7);
      color: white;
      padding: 5px 10px;
      border-radius: 20px;
      font-size: 0.8rem;
    }
    
    .video-controls {
      display: flex;
      justify-content: center;
      gap: 10px;
    }
    
    button {
      background: var(--accent);
      color: white;
      border: none;
      padding: 8px 15px;
      border-radius: 5px;
      cursor: pointer;
      transition: background 0.3s ease;
    }
    
    button:hover {
      background: var(--highlight);
    }
    
    .sensors-section {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 15px;
    }
    
    @media (max-width: 768px) {
      .sensors-section {
        grid-template-columns: 1fr;
      }
    }
    
    .sensor-card {
      background: var(--card-bg);
      border-radius: 15px;
      padding: 20px;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
      transition: transform 0.3s ease;
    }
    
    .sensor-card:hover {
      transform: translateY(-5px);
    }
    
    .sensor-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 15px;
    }
    
    .sensor-title {
      font-size: 1.2rem;
      font-weight: 600;
    }
    
    .sensor-icon {
      font-size: 1.8rem;
    }
    
    .sensor-value {
      font-size: 2.5rem;
      font-weight: 700;
      text-align: center;
      margin: 10px 0;
    }
    
    .sensor-unit {
      font-size: 1rem;
      opacity: 0.7;
    }
    
    .sensor-status {
      text-align: center;
      font-size: 0.9rem;
      padding: 5px;
      border-radius: 5px;
      margin-top: 10px;
    }
    
    .good { background: rgba(76, 201, 240, 0.2); color: #4cc9f0; }
    .moderate { background: rgba(233, 69, 96, 0.2); color: #e94560; }
    .poor { background: rgba(220, 20, 60, 0.2); color: #dc143c; }
    
    .charts-section {
      background: var(--card-bg);
      border-radius: 15px;
      padding: 20px;
      margin-top: 20px;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
    }
    
    .charts-title {
      font-size: 1.5rem;
      margin-bottom: 20px;
      text-align: center;
      color: #4cc9f0;
    }
    
    .charts-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 15px;
    }
    
    @media (max-width: 1024px) {
      .charts-grid {
        grid-template-columns: repeat(2, 1fr);
      }
    }
    
    @media (max-width: 768px) {
      .charts-grid {
        grid-template-columns: 1fr;
      }
    }
    
    .chart-container {
      background: rgba(0, 0, 0, 0.2);
      border-radius: 10px;
      padding: 15px;
      height: 250px;
    }
    
    .update-info {
      text-align: center;
      margin-top: 20px;
      padding: 10px;
      background: rgba(0, 0, 0, 0.2);
      border-radius: 10px;
      font-size: 0.9rem;
    }
    
    footer {
      text-align: center;
      margin-top: 30px;
      padding: 15px;
      font-size: 0.9rem;
      opacity: 0.7;
    }

    
  </style>
</head>
<body>
  <div class="container">

    <div class="sidebar close" id="sidebar">
  <div class="logo">
    <h2>ODV-LAB</h2>
    <i class="bx bx-x closeBtn"></i>
  </div>
  <ul class="nav-links">
    <li class="active" data-page="dashboard">
      <i class="bx bx-grid-alt"></i>
      <span class="link-name">Dashboard</span>
    </li>
    <li data-page="analyze">
      <i class="bx bx-file"></i>
      <span class="link-name">Analyze</span>
    </li>
  </ul>
</div>

    <header>
      <h1>Dashboard Air Quality - Video Monitoring</h1>
      <p class="subtitle">Box Lovely N¬∞01 - Ecuries ODV-LAB</p>
    </header>
    
    <div class="dashboard">
      <div class="video-section">
        <h2 class="video-title">Retour vid√©o de ESP32CAM</h2>
        <div class="video-container">
          <!-- Replace with your ESP32 camera stream -->
          <img src="http://192.168.1.16:9082" alt="ESP32-CAM Stream">
        </div>
      </div>
      
      <div class="sensors-section">
        <div class="sensor-card">
          <div class="sensor-header">
            <div class="sensor-title">Humidit√©</div>
            <div class="sensor-icon">üíß</div>
          </div>
          <div class="sensor-value" id="humidityValue">40.2<span class="sensor-unit">%</span></div>
          <div class="sensor-status good">Normal</div>
        </div>
        
        <div class="sensor-card">
          <div class="sensor-header">
            <div class="sensor-title">Temp√©rature</div>
            <div class="sensor-icon">üå°Ô∏è</div>
          </div>
          <div class="sensor-value" id="temperatureValue">22.5<span class="sensor-unit">¬∞C</span></div>
          <div class="sensor-status good">Confortable</div>
        </div>
        
        <div class="sensor-card">
          <div class="sensor-header">
            <div class="sensor-title">CO‚ÇÇ</div>
            <div class="sensor-icon">üü¢</div>
          </div>
          <div class="sensor-value" id="co2Value">446<span class="sensor-unit">ppm</span></div>
          <div class="sensor-status good">Excellent</div>
        </div>
        
        <div class="sensor-card">
          <div class="sensor-header">
            <div class="sensor-title">Pression</div>
            <div class="sensor-icon">üå™Ô∏è</div>
          </div>
          <div class="sensor-value" id="pressureValue">1013.2<span class="sensor-unit">hPa</span></div>
          <div class="sensor-status good">Stable</div>
        </div>
        
        <div class="sensor-card">
          <div class="sensor-header">
            <div class="sensor-title">PM 2.5</div>
            <div class="sensor-icon">üå´Ô∏è</div>
          </div>
          <div class="sensor-value" id="pm25Value">5.3<span class="sensor-unit">¬µg/m¬≥</span></div>
          <div class="sensor-status good">Bon</div>
        </div>
        
        <div class="sensor-card">
          <div class="sensor-header">
            <div class="sensor-title">PM 10</div>
            <div class="sensor-icon">üå´Ô∏è</div>
          </div>
          <div class="sensor-value" id="pm10Value">12.1<span class="sensor-unit">¬µg/m¬≥</span></div>
          <div class="sensor-status moderate">Mod√©r√©</div>
        </div>
      </div>
    </div>
    
    <div class="charts-section">
      <h2 class="charts-title">Historique des donn√©es</h2>
      <div class="update-info">
        Mise √† jour automatique des graphiques suivant l'enregistrement des valeurs dans la base de donn√©es
      </div>
      <div class="charts-grid">
        <div class="chart-container">
          <canvas id="temperatureChart"></canvas>
        </div>
        <div class="chart-container">
          <canvas id="humidityChart"></canvas>
        </div>
        <div class="chart-container">
          <canvas id="co2Chart"></canvas>
        </div>
        <div class="chart-container">
          <canvas id="pressureChart"></canvas>
        </div>
        <div class="chart-container">
          <canvas id="pm25Chart"></canvas>
        </div>
        <div class="chart-container">
          <canvas id="pm10Chart"></canvas>
        </div>
      </div>
    </div>
    
    <footer>
      <p>Dashboard Air Quality - Video Monitoring | Box Lovely N¬∞01 - Ecuries ODV-LAB</p>
    </footer>
  </div>

  <script>
    // Initialize charts
    const chartOptions = {
      responsive: true,
      maintainAspectRatio: false,
      plugins: {
        legend: {
          display: false
        }
      },
      scales: {
        x: {
          grid: {
            color: 'rgba(255, 255, 255, 0.1)'
          },
          ticks: {
            color: 'rgba(255, 255, 255, 0.7)'
          }
        },
        y: {
          grid: {
            color: 'rgba(255, 255, 255, 0.1)'
          },
          ticks: {
            color: 'rgba(255, 255, 255, 0.7)'
          }
        }
      }
    };
    
    // Generate time labels for the last 24 hours
    const generateTimeLabels = () => {
      const labels = [];
      for (let i = 23; i >= 0; i--) {
        const d = new Date();
        d.setHours(d.getHours() - i);
        labels.push(d.getHours() + 'h');
      }
      return labels;
    };
    
    // Generate random data for demonstration
    const generateData = (baseValue, variation, count) => {
      const data = [];
      for (let i = 0; i < count; i++) {
        data.push(baseValue + (Math.random() * variation * 2 - variation));
      }
      return data;
    };
    
    // Create charts
    const timeLabels = generateTimeLabels();
    
    const temperatureChart = new Chart(document.getElementById('temperatureChart'), {
      type: 'line',
      data: {
        labels: timeLabels,
        datasets: [{
          label: 'Temp√©rature',
          data: generateData(22, 3, 24),
          borderColor: '#e94560',
          backgroundColor: 'rgba(233, 69, 96, 0.1)',
          tension: 0.4,
          fill: true
        }]
      },
      options: chartOptions
    });
    
    const humidityChart = new Chart(document.getElementById('humidityChart'), {
      type: 'line',
      data: {
        labels: timeLabels,
        datasets: [{
          label: 'Humidit√©',
          data: generateData(45, 10, 24),
          borderColor: '#4cc9f0',
          backgroundColor: 'rgba(76, 201, 240, 0.1)',
          tension: 0.4,
          fill: true
        }]
      },
      options: chartOptions
    });
    
    const co2Chart = new Chart(document.getElementById('co2Chart'), {
      type: 'line',
      data: {
        labels: timeLabels,
        datasets: [{
          label: 'CO‚ÇÇ',
          data: generateData(450, 100, 24),
          borderColor: '#2ecc71',
          backgroundColor: 'rgba(46, 204, 113, 0.1)',
          tension: 0.4,
          fill: true
        }]
      },
      options: chartOptions
    });
    
    const pressureChart = new Chart(document.getElementById('pressureChart'), {
      type: 'line',
      data: {
        labels: timeLabels,
        datasets: [{
          label: 'Pression',
          data: generateData(1013, 5, 24),
          borderColor: '#9b59b6',
          backgroundColor: 'rgba(155, 89, 182, 0.1)',
          tension: 0.4,
          fill: true
        }]
      },
      options: chartOptions
    });
    
    const pm25Chart = new Chart(document.getElementById('pm25Chart'), {
      type: 'line',
      data: {
        labels: timeLabels,
        datasets: [{
          label: 'PM 2.5',
          data: generateData(5, 3, 24),
          borderColor: '#f39c12',
          backgroundColor: 'rgba(243, 156, 18, 0.1)',
          tension: 0.4,
          fill: true
        }]
      },
      options: chartOptions
    });
    
    const pm10Chart = new Chart(document.getElementById('pm10Chart'), {
      type: 'line',
      data: {
        labels: timeLabels,
        datasets: [{
          label: 'PM 10',
          data: generateData(12, 5, 24),
          borderColor: '#d35400',
          backgroundColor: 'rgba(211, 84, 0, 0.1)',
          tension: 0.4,
          fill: true
        }]
      },
      options: chartOptions
    });
    
    // Update sensor data with random values (simulating real-time updates)
    function updateSensorData() {
      // Generate new random values
      const newHumidity = (40 + Math.random() * 20).toFixed(1);
      const newTemperature = (20 + Math.random() * 5).toFixed(1);
      const newCO2 = (400 + Math.random() * 200).toFixed(0);
      const newPressure = (1010 + Math.random() * 10).toFixed(1);
      const newPM25 = (3 + Math.random() * 10).toFixed(1);
      const newPM10 = (8 + Math.random() * 15).toFixed(1);
      
      // Update display values
      document.getElementById('humidityValue').innerHTML = `${newHumidity}<span class="sensor-unit">%</span>`;
      document.getElementById('temperatureValue').innerHTML = `${newTemperature}<span class="sensor-unit">¬∞C</span>`;
      document.getElementById('co2Value').innerHTML = `${newCO2}<span class="sensor-unit">ppm</span>`;
      document.getElementById('pressureValue').innerHTML = `${newPressure}<span class="sensor-unit">hPa</span>`;
      document.getElementById('pm25Value').innerHTML = `${newPM25}<span class="sensor-unit">¬µg/m¬≥</span>`;
      document.getElementById('pm10Value').innerHTML = `${newPM10}<span class="sensor-unit">¬µg/m¬≥</span>`;
      
      // Update status indicators based on values
      updateStatusIndicators(newHumidity, newTemperature, newCO2, newPressure, newPM25, newPM10);
      
      // Update charts with new data point
      updateCharts(newHumidity, newTemperature, newCO2, newPressure, newPM25, newPM10);
    }
    
    function updateStatusIndicators(humidity, temperature, co2, pressure, pm25, pm10) {
      // Simple logic to determine status (can be customized)
      const humidityStatus = humidity > 60 ? 'poor' : humidity > 40 ? 'moderate' : 'good';
      const temperatureStatus = temperature > 28 ? 'poor' : temperature > 22 ? 'moderate' : 'good';
      const co2Status = co2 > 1000 ? 'poor' : co2 > 600 ? 'moderate' : 'good';
      const pressureStatus = 'good'; // Pressure is usually stable
      const pm25Status = pm25 > 35 ? 'poor' : pm25 > 12 ? 'moderate' : 'good';
      const pm10Status = pm10 > 50 ? 'poor' : pm10 > 20 ? 'moderate' : 'good';
      
      // Update status text
      document.querySelectorAll('.sensor-card')[0].querySelector('.sensor-status').className = `sensor-status ${humidityStatus}`;
      document.querySelectorAll('.sensor-card')[0].querySelector('.sensor-status').textContent = 
        humidityStatus === 'good' ? 'Normal' : humidityStatus === 'moderate' ? '√âlev√©' : 'Critique';
      
      document.querySelectorAll('.sensor-card')[1].querySelector('.sensor-status').className = `sensor-status ${temperatureStatus}`;
      document.querySelectorAll('.sensor-card')[1].querySelector('.sensor-status').textContent = 
        temperatureStatus === 'good' ? 'Confortable' : temperatureStatus === 'moderate' ? 'Chaud' : 'Tr√®s chaud';
      
      document.querySelectorAll('.sensor-card')[2].querySelector('.sensor-status').className = `sensor-status ${co2Status}`;
      document.querySelectorAll('.sensor-card')[2].querySelector('.sensor-status').textContent = 
        co2Status === 'good' ? 'Excellent' : co2Status === 'moderate' ? 'Mod√©r√©' : '√âlev√©';
      
      document.querySelectorAll('.sensor-card')[3].querySelector('.sensor-status').className = `sensor-status ${pressureStatus}`;
      document.querySelectorAll('.sensor-card')[3].querySelector('.sensor-status').textContent = 'Stable';
      
      document.querySelectorAll('.sensor-card')[4].querySelector('.sensor-status').className = `sensor-status ${pm25Status}`;
      document.querySelectorAll('.sensor-card')[4].querySelector('.sensor-status').textContent = 
        pm25Status === 'good' ? 'Bon' : pm25Status === 'moderate' ? 'Mod√©r√©' : 'Mauvais';
      
      document.querySelectorAll('.sensor-card')[5].querySelector('.sensor-status').className = `sensor-status ${pm10Status}`;
      document.querySelectorAll('.sensor-card')[5].querySelector('.sensor-status').textContent = 
        pm10Status === 'good' ? 'Bon' : pm10Status === 'moderate' ? 'Mod√©r√©' : 'Mauvais';
    }
    
    function updateCharts(humidity, temperature, co2, pressure, pm25, pm10) {
      // Shift all data points and add new one
      const shiftData = (chart) => {
        chart.data.labels.push('');
        chart.data.labels.shift();
        
        chart.data.datasets.forEach((dataset) => {
          dataset.data.push(0); // Will be set to actual value below
          dataset.data.shift();
        });
        
        chart.update('none');
      };
      
      // Update each chart with new data
      shiftData(temperatureChart);
      temperatureChart.data.datasets[0].data[temperatureChart.data.datasets[0].data.length - 1] = parseFloat(temperature);
      
      shiftData(humidityChart);
      humidityChart.data.datasets[0].data[humidityChart.data.datasets[0].data.length - 1] = parseFloat(humidity);
      
      shiftData(co2Chart);
      co2Chart.data.datasets[0].data[co2Chart.data.datasets[0].data.length - 1] = parseFloat(co2);
      
      shiftData(pressureChart);
      pressureChart.data.datasets[0].data[pressureChart.data.datasets[0].data.length - 1] = parseFloat(pressure);
      
      shiftData(pm25Chart);
      pm25Chart.data.datasets[0].data[pm25Chart.data.datasets[0].data.length - 1] = parseFloat(pm25);
      
      shiftData(pm10Chart);
      pm10Chart.data.datasets[0].data[pm10Chart.data.datasets[0].data.length - 1] = parseFloat(pm10);
      
      // Update charts
      temperatureChart.update();
      humidityChart.update();
      co2Chart.update();
      pressureChart.update();
      pm25Chart.update();
      pm10Chart.update();
    }
    
    // Camera controls
    document.getElementById('refreshBtn').addEventListener('click', function() {
      const img = document.querySelector('.video-container img');
      // Add timestamp to prevent caching
      img.src = "http://192.168.1.16:9082?" + new Date().getTime();
    });
    
    document.getElementById('fullscreenBtn').addEventListener('click', function() {
      const img = document.querySelector('.video-container img');
      if (img.requestFullscreen) {
        img.requestFullscreen();
      } else if (img.webkitRequestFullscreen) {
        img.webkitRequestFullscreen();
      } else if (img.msRequestFullscreen) {
        img.msRequestFullscreen();
      }
    });
    
    document.getElementById('snapshotBtn').addEventListener('click', function() {
      // In a real implementation, this would capture the current frame
      alert('Fonction de capture d\'√©cran activ√©e');
    });
    
    // Update data every 5 seconds
    setInterval(updateSensorData, 5000);
    
    // Initial data update
    updateSensorData();
  </script>
</body>
</html>